(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{167:function(e,t,n){e.exports=n(207)},199:function(e,t){},207:function(e,t,n){"use strict";n.r(t);var o=n(22),a=n.n(o),r=n(112),c=n.n(r),i=n(96),u=n(72),s=n.n(u),l=n(93),d=n(70),f=n(42),p=Object(o.createContext)(void 0),v=function(e){var t=e.width,n=e.height,r=e.engineOptions,c=e.adaptToDeviceRatio,i=e.onSceneMount,u=e.children,s=Object(o.useState)(),l=Object(d.a)(s,2),v=l[0],b=l[1],h=Object(o.useRef)(null);return Object(o.useEffect)(function(){var e=h.current;if(e){var t=new f.b(e,!0,r,c),n=new f.g(t);if(i){var o={scene:n,engine:t,canvas:e};i(o),b(o),t.runRenderLoop(function(){n.render()})}}},[h]),a.a.createElement("div",null,a.a.createElement(p.Provider,{value:v},a.a.createElement("canvas",{width:t,height:n,ref:h}),v&&u))};var b=n(163),h=n(164),m=n(139),w=n.n(m),g=n(140),j=n.n(g),O=new(function(){function e(){Object(b.a)(this,e),this.rtc=void 0}return Object(h.a)(e,[{key:"create",value:function(e,t,n){var o=this,a=w.a.connect(e);return new Promise(function(e){var r=new j.a({nodeId:"answer",trickle:n});a.emit("create",{roomId:t}),a.on("sdp",function(e){console.log({data:e}),r.setSdp(e.sdp)});var c=r.onSignal.subscribe(function(e){console.log({sdp:e,roomId:t}),a.emit("sdp",{sdp:e,roomId:t})});r.onConnect.once(function(){console.log("connect"),c.unSubscribe(),e(r)}),o.rtc=r})}},{key:"join",value:function(e,t,n){var o=this,a=w.a.connect(e);return new Promise(function(e){var r=new j.a({nodeId:"offer",trickle:n});a.emit("join",{roomId:t}),a.on("join",function(){r.makeOffer()}),a.on("sdp",function(e){console.log({data:e}),r.setSdp(e.sdp)});var c=r.onSignal.subscribe(function(e){console.log({sdp:e,roomId:t}),a.emit("sdp",{sdp:e,roomId:t})});r.onConnect.once(function(){console.log("connect"),e(r),c.unSubscribe()}),o.rtc=r})}},{key:"peer",get:function(){return this.rtc}}]),e}()),x=n(69),y=n.n(x),k=function(e){var t=e.stream,n=e.ratio,r=e.onMount,c=Object(o.useContext)(p);return Object(o.useEffect)(function(){Object(l.a)(s.a.mark(function e(){var o,a,i,u,l,d,p,v,b;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=26;break}return o=new y.a,a=c.scene,i=n?n.vertical:2,u=n?n.horizontal:3.4,console.log({stream:t}),(l=f.f.CreatePlane("desktop",{width:u,height:i},a)).position=new f.j(0,i/2,0),l.rotation=new f.j(0,0,0),d=new f.h("mat",a),e.next=12,f.k.CreateFromStreamAsync(a,t);case 12:(p=e.sent).uScale=1,p.vScale=-1,d.diffuseTexture=p,l.material=d,a.onPointerUp=function(){p.video.play()},v=f.e.CreatePlane("impact",1,a),b=v.material=new f.h("impactMat",a),v.scaling=new f.j(.02,.02,.04),b.diffuseTexture=new f.i("textures/impact.png",a),b.diffuseTexture.hasAlpha=!0,v.position=new f.j(0,0,-.01),a.onPointerDown=function(e,t){if(t.hit){var n=t.pickedPoint,a=n.x,r=n.y;-1.7<a&&a<1.7&&(v.position.x=a),0<r&&r<2&&(v.position.y=r);var c=r/i;o.execute({x:(a+1.7)/u,y:1-c})}},r&&r({mouseMoveEvent:o});case 26:case"end":return e.stop()}},e)}))()},[c]),a.a.createElement(o.Fragment,null)},E=Object(o.createContext)(void 0),S=function(e){var t=e.onMount,n=e.children,r=Object(o.useContext)(p),c=Object(o.useState)(),i=Object(d.a)(c,2),u=i[0],s=i[1];return Object(o.useEffect)(function(){if(r){var e=new y.a,n=new y.a,o=r.scene,a=["".concat(".","/textures/Space/space_left.jpg"),"".concat(".","/textures/Space/space_up.jpg"),"".concat(".","/textures/Space/space_front.jpg"),"".concat(".","/textures/Space/space_right.jpg"),"".concat(".","/textures/Space/space_down.jpg"),"".concat(".","/textures/Space/space_back.jpg")],c=f.a.CreateFromImages(a,o),i=o.createDefaultEnvironment({groundYBias:1,createSkybox:!0,skyboxSize:150,skyboxTexture:c}),u=o.createDefaultVRExperience({createDeviceOrientationCamera:!1});u.enableTeleportation({floorMeshes:[i.ground]}),u.onControllerMeshLoaded.add(function(t){t.onSecondaryButtonStateChangedObservable.add(function(n,o){var a=t.hand;"right"!==a&&"left"!==a||n.pressed&&e&&e.execute({hand:a})})}),o.onBeforeRenderObservable.add(function(){var e=u.webVRCamera.devicePosition.clone(),t=u.webVRCamera.deviceRotationQuaternion.clone();n.execute({pos:e,qua:t})});var l={cotrollerActionEvent:e,vrPositionEvent:n};t&&t(l),s(l)}},[r]),a.a.createElement(E.Provider,{value:u},u&&n)},C=n(101),M=function(e){return{key:e}},P=n(166),I={keyboardOpen:!1};var T=function(e){var t=e.onMount,n=Object(o.useContext)(p),r=Object(o.useContext)(E),c=Object(i.b)();return Object(o.useEffect)(function(){if(n&&r){var e=new y.a,o=n.scene,a=r.cotrollerActionEvent,i=r.vrPositionEvent,u=f.f.CreatePlane("ui",{width:1,height:1},o);u.isVisible=!1;var d=C.a.CreateForMesh(u,1024,1024),p=new C.c;p.width=.2,p.maxWidth=.2,p.height="40px",p.color="white",p.background="green",d.addControl(p);var v=C.d.CreateDefaultLayout();v.verticalAlignment=C.b.VERTICAL_ALIGNMENT_BOTTOM,d.addControl(v),v.connect(p);var b=p.text;p.onTextChangedObservable.add(function(t){console.log({e:t},p.text),p.text===b.slice(0,-1)?(console.log("back"),e.execute(M("backspace"))):e.execute(M(t.currentKey)),b=p.text}),p.onBlurObservable.add(function(){e.execute(M("enter")),p.text=""}),a.subscribe(function(){var e=Object(l.a)(s.a.mark(function e(t){var n,o,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("left"!==t.hand){e.next=12;break}return u.isVisible=!u.isVisible,c({type:"devices_keyboardSwitch",payload:u.isVisible}),e.next=6,i.asPromise();case 6:n=e.sent,o=n.pos,a=n.qua,u.position=o,u.rotationQuaternion=a,u.translate(new f.j(0,0,.6),1);case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),t&&t({keyboardActionEvent:e})}},[n]),a.a.createElement(o.Fragment,null)};var A=function(){var e=function(){var e=Object(o.useState)(""),t=Object(d.a)(e,2),n=t[0],a=t[1];return[n,function(e){a(e.target.value)},function(){a("")}]}(),t=Object(d.a)(e,3),n=t[0],r=t[1],c=t[2],u=Object(o.useRef)(),p=Object(o.useState)(),b=Object(d.a)(p,2),h=b[0],m=b[1],w=function(e){var t=Object(o.useRef)(),n=Object(i.c)(e);return Object(o.useEffect)(function(){t.current=n},[n]),t}(function(e){return e.devices.keyboardOpen}),g=function(){var e=Object(l.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.join("https://aqueous-earth-75182.herokuapp.com/",n,!1);case 2:c(),O.peer&&O.peer.onAddTrack.subscribe(function(e){m(e),console.log(e),u.current.srcObject=e});case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return a.a.createElement("div",null,a.a.createElement("div",{style:{display:"flex"}},a.a.createElement("input",{onChange:r,value:n}),a.a.createElement("button",{onClick:g},"connect")),a.a.createElement(v,{onSceneMount:function(e){var t=e.canvas,n=e.scene;new f.d("sunLight",new f.j(0,1,0),n),new f.c("camera",new f.j(0,1,-2),n).attachControl(t,!0),n.activeCamera.beta+=.8},height:400,width:600},a.a.createElement(S,{onMount:function(e){e.cotrollerActionEvent.subscribe(function(e){var t=e.hand;O.peer&&"right"===t&&!w.current&&O.peer.send(JSON.stringify({type:"click"}))})}},a.a.createElement(T,{onMount:function(e){e.keyboardActionEvent.subscribe(function(e){var t=e.key;O.peer&&O.peer.send(JSON.stringify({type:"key",payload:t}))})}})),h&&a.a.createElement(k,{stream:h,ratio:{vertical:2,horizontal:3.4},onMount:function(e){e.mouseMoveEvent.subscribe(function(e){console.log("ref",w.current),O.peer&&!w.current&&O.peer.send(JSON.stringify({type:"move",payload:e}))})}})),a.a.createElement("video",{ref:u,autoPlay:!0,width:100,height:100}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var R=n(98),_=n(165),V=n.n(_),B=Object(R.c)({devices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"devices_keyboardSwitch":return Object(P.a)({},e,{keyboardOpen:t.payload});default:return e}}});var D=Object(R.d)(B,Object(R.a)(V.a));c.a.render(a.a.createElement(i.a,{store:D},a.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[167,1,2]]]);
//# sourceMappingURL=main.cf458249.chunk.js.map