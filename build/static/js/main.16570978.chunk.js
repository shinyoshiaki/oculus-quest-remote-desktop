(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{188:function(e,t,n){e.exports=n(231)},220:function(e,t){},231:function(e,t,n){"use strict";n.r(t);var a=n(24),o=n.n(a),r=n(127),c=n.n(r),i=n(111),u=n(69),s=n.n(u),l=n(84),d=n(81),f=n(43),p=Object(a.createContext)(void 0),v=function(e){var t=e.width,n=e.height,r=e.engineOptions,c=e.adaptToDeviceRatio,i=e.onSceneMount,u=e.children,s=Object(a.useState)(),l=Object(d.a)(s,2),v=l[0],b=l[1],m=Object(a.useRef)(null);return Object(a.useEffect)(function(){var e=m.current;if(e){var t=new f.b(e,!0,r,c),n=new f.g(t);if(i){var a={scene:n,engine:t,canvas:e};i(a),b(a),t.runRenderLoop(function(){n.render()})}}},[m]),o.a.createElement("div",null,o.a.createElement(p.Provider,{value:v},o.a.createElement("canvas",{width:t,height:n,ref:m}),v&&u))};var b=n(184),m=n(185),h=n(158),w=n.n(h),g=n(159),O=n.n(g),x=new(function(){function e(){Object(b.a)(this,e),this.rtc=void 0}return Object(m.a)(e,[{key:"create",value:function(e,t,n){var a=this,o=w.a.connect(e);return new Promise(function(e){var r=new O.a({nodeId:"answer",trickle:n});o.emit("create",{roomId:t}),o.on("sdp",function(e){console.log({data:e}),r.setSdp(e.sdp)});var c=r.onSignal.subscribe(function(e){console.log({sdp:e,roomId:t}),o.emit("sdp",{sdp:e,roomId:t})});r.onConnect.once(function(){console.log("connect"),c.unSubscribe(),e(r)}),a.rtc=r})}},{key:"join",value:function(e,t,n){var a=this,o=w.a.connect(e);return new Promise(function(e){var r=new O.a({nodeId:"offer",trickle:n});o.emit("join",{roomId:t}),o.on("join",function(){r.makeOffer()}),o.on("sdp",function(e){console.log({data:e}),r.setSdp(e.sdp)});var c=r.onSignal.subscribe(function(e){console.log({sdp:e,roomId:t}),o.emit("sdp",{sdp:e,roomId:t})});r.onConnect.once(function(){console.log("connect"),e(r),c.unSubscribe()}),a.rtc=r})}},{key:"peer",get:function(){return this.rtc}}]),e}()),k=n(70),j=n.n(k),y=function(e){var t=e.stream,n=e.ratio,r=e.onMount,c=Object(a.useContext)(p);return Object(a.useEffect)(function(){Object(l.a)(s.a.mark(function e(){var a,o,i,u,l,d,p,v,b;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=25;break}return a=new j.a,o=c.scene,i=n?n.vertical:2,u=n?n.horizontal:3.4,(l=f.f.CreatePlane("desktop",{width:u,height:i},o)).position=new f.k(0,i/2,0),l.rotation=new f.k(0,0,0),d=new f.i("mat",o),e.next=11,f.l.CreateFromStreamAsync(o,t);case 11:(p=e.sent).uScale=1,p.vScale=-1,d.diffuseTexture=p,l.material=d,o.onPointerUp=function(){p.video.play()},v=f.e.CreatePlane("impact",1,o),b=v.material=new f.i("impactMat",o),v.scaling=new f.k(.02,.02,.04),b.diffuseTexture=new f.j("textures/impact.png",o),b.diffuseTexture.hasAlpha=!0,v.position=new f.k(0,0,-.01),o.onPointerDown=function(e,t){if(t.hit){var n=t.pickedPoint,o=n.x,r=n.y;-1.7<o&&o<1.7&&(v.position.x=o),0<r&&r<2&&(v.position.y=r);var c=r/i;a.execute({x:(o+1.7)/u,y:1-c})}},r&&r({mouseMoveEvent:a});case 25:case"end":return e.stop()}},e)}))()},[c]),o.a.createElement(a.Fragment,null)},E=Object(a.createContext)(void 0),S=function(e){var t=e.onMount,n=e.children,r=Object(a.useContext)(p),c=Object(a.useState)(),i=Object(d.a)(c,2),u=i[0],s=i[1];return Object(a.useEffect)(function(){if(r){var e=new j.a,n=new j.a,a=r.scene,o=["".concat(".","/textures/Space/space_left.jpg"),"".concat(".","/textures/Space/space_up.jpg"),"".concat(".","/textures/Space/space_front.jpg"),"".concat(".","/textures/Space/space_right.jpg"),"".concat(".","/textures/Space/space_down.jpg"),"".concat(".","/textures/Space/space_back.jpg")],c=f.a.CreateFromImages(o,a),i=a.createDefaultEnvironment({groundYBias:1,createSkybox:!0,skyboxSize:150,skyboxTexture:c}),u=a.createDefaultVRExperience({createDeviceOrientationCamera:!1});u.enableTeleportation({floorMeshes:[i.ground]}),u.onControllerMeshLoaded.add(function(t){t.onSecondaryButtonStateChangedObservable.add(function(n,a){var o=t.hand;"right"!==o&&"left"!==o||n.pressed&&e&&e.execute({hand:o})})}),a.onBeforeRenderObservable.add(function(){var e=u.webVRCamera.devicePosition.clone(),t=u.webVRCamera.deviceRotationQuaternion.clone();n.execute({pos:e,qua:t})});var l={cotrollerActionEvent:e,vrPositionEvent:n};t&&t(l),s(l)}},[r]),o.a.createElement(E.Provider,{value:u},u&&n)},C=function(e){return{key:e}},M=n(187),P={keyboardOpen:!1};var T=n(119),A=function(e){var t=e.onMount,n=Object(a.useContext)(p),r=Object(a.useContext)(E),c=Object(i.b)();return Object(a.useEffect)(function(){if(n&&r){var e=new j.a,a=n.scene,o=r.cotrollerActionEvent,i=r.vrPositionEvent,u=f.f.CreatePlane("ui",{width:1,height:1},a);u.isVisible=!1;var d=T.a.CreateForMesh(u,1024,1024),p=new T.c;p.width=.2,p.maxWidth=.2,p.height="40px",p.color="white",p.background="green",p.disableMobilePrompt=!0,d.addControl(p);var v=T.d.CreateDefaultLayout();v.verticalAlignment=T.b.VERTICAL_ALIGNMENT_BOTTOM,d.addControl(v),v.connect(p);var b=p.text;p.onTextChangedObservable.add(function(t){console.log({e:t},p.text),p.text===b.slice(0,-1)?(console.log("back"),e.execute(C("backspace"))):e.execute(C(t.currentKey)),b=p.text}),p.onBlurObservable.add(function(){e.execute(C("enter")),p.text=""}),o.subscribe(function(){var e=Object(l.a)(s.a.mark(function e(t){var n,a,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("left"!==t.hand){e.next=12;break}return u.isVisible=!u.isVisible,c({type:"devices_keyboardSwitch",payload:u.isVisible}),e.next=6,i.asPromise();case 6:n=e.sent,a=n.pos,o=n.qua,u.position=a,u.rotationQuaternion=o,u.translate(new f.k(0,0,.6),1);case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),t&&t({keyboardActionEvent:e})}},[n]),o.a.createElement(a.Fragment,null)};var I=function(e){var t=e.stream,n=Object(a.useContext)(p);return Object(a.useEffect)(function(){Object(l.a)(s.a.mark(function e(){var a,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t&&n&&t.getAudioTracks()[0]&&(a=n.scene,(o=new f.h("Violons",t,a,null,{autoplay:!0,streaming:!0,spatialSound:!0})).setDirectionalCone(90,180,0),o.setLocalDirectionToMesh(new f.k(1,0,0)));case 1:case"end":return e.stop()}},e)}))()},[t]),o.a.createElement(a.Fragment,null)},R=function(){var e=function(){var e=Object(a.useState)(""),t=Object(d.a)(e,2),n=t[0],o=t[1];return[n,function(e){o(e.target.value)},function(){o("")}]}(),t=Object(d.a)(e,3),n=t[0],r=t[1],c=t[2],u=Object(a.useState)(),p=Object(d.a)(u,2),b=p[0],m=p[1],h=function(e){var t=Object(i.c)(e),n=Object(a.useRef)(t);return Object(a.useEffect)(function(){n.current=t},[t]),n}(function(e){return e.devices.keyboardOpen}),w=function(){var e=Object(l.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.join("https://aqueous-earth-75182.herokuapp.com/",n,!1);case 2:c(),x.peer&&x.peer.onAddTrack.subscribe(function(e){console.log({ms:e}),m(e)});case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return o.a.createElement("div",null,o.a.createElement("div",{style:{display:"flex"}},o.a.createElement("input",{onChange:r,value:n}),o.a.createElement("button",{onClick:w},"connect")),o.a.createElement(v,{onSceneMount:function(e){var t=e.canvas,n=e.scene;new f.d("sunLight",new f.k(0,1,0),n),new f.c("camera",new f.k(0,1,-2),n).attachControl(t,!0),n.activeCamera.beta+=.8},height:400,width:600},o.a.createElement(S,{onMount:function(e){e.cotrollerActionEvent.subscribe(function(e){var t=e.hand;x.peer&&"right"===t&&!h.current&&x.peer.send(JSON.stringify({type:"click"}))})}},o.a.createElement(A,{onMount:function(e){e.keyboardActionEvent.subscribe(function(e){var t=e.key;x.peer&&x.peer.send(JSON.stringify({type:"key",payload:t}))})}})),b&&o.a.createElement(a.Fragment,null,o.a.createElement(y,{stream:b,ratio:{vertical:2,horizontal:3.4},onMount:function(e){e.mouseMoveEvent.subscribe(function(e){console.log("ref",h.current),x.peer&&!h.current&&x.peer.send(JSON.stringify({type:"move",payload:e}))})}}),o.a.createElement(I,{stream:b}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var _=n(113),V=n(186),D=n.n(V),B=Object(_.c)({devices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"devices_keyboardSwitch":return Object(M.a)({},e,{keyboardOpen:t.payload});default:return e}}});var F=Object(_.d)(B,Object(_.a)(D.a));c.a.render(o.a.createElement(i.a,{store:F},o.a.createElement(R,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[188,1,2]]]);
//# sourceMappingURL=main.16570978.chunk.js.map