(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{178:function(e,n,t){e.exports=t(225)},210:function(e,n){},225:function(e,n,t){"use strict";t.r(n);var o=t(15),r=t.n(o),a=t(119),c=t.n(a),i=t(175),u=t(86),s=t(102),l=t(77),d=t.n(l),f=t(99),v=t(75),b=t(43),p=Object(o.createContext)(void 0),h=function(e){var n=e.width,t=e.height,a=e.engineOptions,c=e.adaptToDeviceRatio,i=e.onSceneMount,u=e.children,s=Object(o.useState)(),l=Object(v.a)(s,2),d=l[0],f=l[1],h=Object(o.useRef)(null);return Object(o.useEffect)(function(){var e=h.current;if(e){var n=new b.b(e,!0,a,c),t=new b.g(n);if(i){var o={scene:t,engine:n,canvas:e};i(o),f(o),n.runRenderLoop(function(){t.render()})}}},[h]),r.a.createElement("div",null,r.a.createElement(p.Provider,{value:d},r.a.createElement("canvas",{width:n,height:t,ref:h}),d&&u))};var m=t(172),w=t(173),g=t(146),O=t.n(g),j=t(147),x=t.n(j),y=new(function(){function e(){Object(m.a)(this,e),this.rtc=void 0}return Object(w.a)(e,[{key:"create",value:function(e,n,t){var o=this,r=O.a.connect(e);return new Promise(function(e){var a=new x.a({nodeId:"answer",trickle:t});r.emit("create",{roomId:n}),r.on("sdp",function(e){console.log({data:e}),a.setSdp(e.sdp)});var c=a.onSignal.subscribe(function(e){console.log({sdp:e,roomId:n}),r.emit("sdp",{sdp:e,roomId:n})});a.onConnect.once(function(){console.log("connect"),c.unSubscribe(),e(a)}),o.rtc=a})}},{key:"join",value:function(e,n,t){var o=this,r=O.a.connect(e);return new Promise(function(e){var a=new x.a({nodeId:"offer",trickle:t});r.emit("join",{roomId:n}),r.on("join",function(){a.makeOffer()}),r.on("sdp",function(e){console.log({data:e}),a.setSdp(e.sdp)});var c=a.onSignal.subscribe(function(e){console.log({sdp:e,roomId:n}),r.emit("sdp",{sdp:e,roomId:n})});a.onConnect.once(function(){console.log("connect"),e(a),c.unSubscribe()}),o.rtc=a})}},{key:"peer",get:function(){return this.rtc}}]),e}()),E=t(74),k=t.n(E),C=function(e){var n=e.stream,t=e.ratio,a=e.onMount,c=Object(o.useContext)(p);return Object(o.useEffect)(function(){Object(f.a)(d.a.mark(function e(){var o,r,i,u,s,l,f,v,p;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=26;break}return o=new k.a,r=c.scene,i=t?t.vertical:2,u=t?t.horizontal:3.4,console.log({stream:n}),(s=b.f.CreatePlane("desktop",{width:u,height:i},r)).position=new b.j(0,i/2,0),s.rotation=new b.j(0,0,0),l=new b.h("mat",r),e.next=12,b.k.CreateFromStreamAsync(r,n);case 12:(f=e.sent).uScale=1,f.vScale=-1,l.diffuseTexture=f,s.material=l,r.onPointerUp=function(){f.video.play()},v=b.e.CreatePlane("impact",1,r),p=v.material=new b.h("impactMat",r),v.scaling=new b.j(.02,.02,.04),p.diffuseTexture=new b.i("textures/impact.png",r),p.diffuseTexture.hasAlpha=!0,v.position=new b.j(0,0,-.01),r.onPointerDown=function(e,n){if(n.hit){var t=n.pickedPoint,r=t.x,a=t.y;-1.7<r&&r<1.7&&(v.position.x=r),0<a&&a<2&&(v.position.y=a);var c=a/i;o.execute({x:(r+1.7)/u,y:1-c})}},a&&a({mouseMoveEvent:o});case 26:case"end":return e.stop()}},e)}))()},[c]),r.a.createElement(o.Fragment,null)},S=Object(o.createContext)(void 0),M=function(e){var n=e.onMount,t=e.children,a=Object(o.useContext)(p),c=Object(o.useState)(),i=Object(v.a)(c,2),u=i[0],s=i[1];return Object(o.useEffect)(function(){if(a){var e=new k.a,t=new k.a,o=a.scene,r=o.createDefaultEnvironment({groundYBias:1});r.setMainColor(b.a.FromHexString("#74b9ff"));var c=o.createDefaultVRExperience({createDeviceOrientationCamera:!1});c.enableTeleportation({floorMeshes:[r.ground]}),c.onControllerMeshLoaded.add(function(n){n.onSecondaryButtonStateChangedObservable.add(function(t,o){var r=n.hand;"right"!==r&&"left"!==r||t.pressed&&e&&e.execute({hand:r})})}),o.onBeforeRenderObservable.add(function(){var e=c.webVRCamera.devicePosition.clone(),n=c.webVRCamera.deviceRotationQuaternion.clone();t.execute({pos:e,qua:n})});var i={cotrollerActionEvent:e,vrPositionEvent:t};n&&n(i),s(i)}},[a]),r.a.createElement(S.Provider,{value:u},u&&t)},P=t(108),A=function(e){return{key:e}},I=t(177),R={keyboardOpen:!1},T=function(e){return{type:"devices_keyboardSwitch",payload:e}};var V=function(e){var n=e.onMount,t=Object(o.useContext)(p),a=Object(o.useContext)(S),c=Object(s.b)();return Object(o.useEffect)(function(){if(t&&a){var e=new k.a,o=t.scene,r=a.cotrollerActionEvent,i=a.vrPositionEvent,u=b.f.CreatePlane("ui",{width:1,height:1},o);u.isVisible=!1;var s=P.a.CreateForMesh(u,1024,1024),l=new P.c;l.width=.2,l.maxWidth=.2,l.height="40px",l.color="white",l.background="green",s.addControl(l);var v=P.d.CreateDefaultLayout();v.verticalAlignment=P.b.VERTICAL_ALIGNMENT_BOTTOM,s.addControl(v),v.connect(l);var p=l.text;l.onTextChangedObservable.add(function(n){console.log({e:n},l.text),l.text===p.slice(0,-1)?(console.log("back"),e.execute(A("backspace"))):e.execute(A(n.currentKey)),p=l.text}),l.onBlurObservable.add(function(){e.execute(A("enter")),l.text="",u.isVisible=!1,c(T(u.isVisible))}),r.subscribe(function(){var e=Object(f.a)(d.a.mark(function e(n){var t,o,r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("left"!==n.hand){e.next=12;break}return u.isVisible=!u.isVisible,c(T(u.isVisible)),e.next=6,i.asPromise();case 6:t=e.sent,o=t.pos,r=t.qua,u.position=o,u.rotationQuaternion=r,u.translate(new b.j(0,0,.6),1);case 12:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}()),n&&n({keyboardActionEvent:e})}},[t]),r.a.createElement(o.Fragment,null)};var B=function(){var e=function(){var e=Object(o.useState)(""),n=Object(v.a)(e,2),t=n[0],r=n[1];return[t,function(e){r(e.target.value)},function(){r("")}]}(),n=Object(v.a)(e,3),t=n[0],a=n[1],c=n[2],i=Object(o.useRef)(),u=Object(o.useState)(),l=Object(v.a)(u,2),p=l[0],m=l[1],w=function(e){var n=Object(o.useRef)(),t=Object(s.c)(e);return Object(o.useEffect)(function(){n.current=t},[t]),n}(function(e){return e.devices.keyboardOpen}),g=function(){var e=Object(f.a)(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.join("https://aqueous-earth-75182.herokuapp.com/",t,!1);case 2:c(),y.peer&&y.peer.onAddTrack.subscribe(function(e){m(e),console.log(e),i.current.srcObject=e});case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("input",{onChange:a,value:t}),r.a.createElement("button",{onClick:g},"connect")),r.a.createElement(h,{onSceneMount:function(e){var n=e.canvas,t=e.scene;new b.d("sunLight",new b.j(0,1,0),t),new b.c("camera",new b.j(0,1,-2),t).attachControl(n,!0),t.activeCamera.beta+=.8},height:400,width:600},r.a.createElement(M,{onMount:function(e){e.cotrollerActionEvent.subscribe(function(e){var n=e.hand;y.peer&&"right"===n&&!w.current&&y.peer.send(JSON.stringify({type:"click"}))})}},r.a.createElement(V,{onMount:function(e){e.keyboardActionEvent.subscribe(function(e){var n=e.key;y.peer&&y.peer.send(JSON.stringify({type:"key",payload:n}))})}})),p&&r.a.createElement(C,{stream:p,ratio:{vertical:2,horizontal:3.4},onMount:function(e){e.mouseMoveEvent.subscribe(function(e){console.log("ref",w.current),y.peer&&!w.current&&y.peer.send(JSON.stringify({type:"move",payload:e}))})}})),r.a.createElement("video",{ref:i,autoPlay:!0,width:100,height:100}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var D=t(104),L=t(174),F=t.n(L),J=Object(D.c)({devices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"devices_keyboardSwitch":return Object(I.a)({},e,{keyboardOpen:n.payload});default:return e}}});var N=Object(D.d)(J,Object(D.a)(F.a));c.a.render(r.a.createElement(s.a,{store:N},r.a.createElement(i.a,null,r.a.createElement("div",null,r.a.createElement(u.a,{exact:!0,path:"/",component:B})))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[178,1,2]]]);
//# sourceMappingURL=main.027bf6ad.chunk.js.map