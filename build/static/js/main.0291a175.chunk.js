(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{55:function(e,n,t){e.exports=t(99)},83:function(e,n){},99:function(e,n,t){"use strict";t.r(n);var a=t(1),o=t.n(a),r=t(50),i=t.n(r),c=t(51),s=t(8),u=t(7),d=t.n(u),l=t(14),p=t(19),f=t(20),h=t(22),v=t(21),m=t(23),w=t(2),g=t(54),b=function(e){function n(){var e,t;Object(p.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(t=Object(h.a)(this,(e=Object(v.a)(n)).call.apply(e,[this].concat(o)))).scene={},t.engine={},t.canvas={},t.onResizeWindow=function(){t.engine&&t.engine.resize()},t.onCanvasLoaded=function(e){null!==e&&(t.canvas=e)},t}return Object(m.a)(n,e),Object(f.a)(n,[{key:"componentDidMount",value:function(){this.engine=new w.Engine(this.canvas,!0,this.props.engineOptions,this.props.adaptToDeviceRatio);var e=new w.Scene(this.engine);this.scene=e,"function"===typeof this.props.onSceneMount?this.props.onSceneMount({scene:e,engine:this.engine,canvas:this.canvas}):console.error("onSceneMount function not available"),window.addEventListener("resize",this.onResizeWindow)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResizeWindow)}},{key:"render",value:function(){var e=this.props,n=e.width,t=e.height,a=(Object(g.a)(e,["width","height"]),{});return void 0!==n&&void 0!==t&&(a.width=n,a.height=t),o.a.createElement("canvas",Object.assign({},a,{ref:this.onCanvasLoaded}))}}]),n}(o.a.Component),y=t(11),S=t.n(y),O=2,x=3.4;function k(e,n){return j.apply(this,arguments)}function j(){return(j=Object(l.a)(d.a.mark(function e(n,t){var a,o,r,i,c,s,u;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.canvas,a=n.scene,n.engine,console.log({stream:t}),(o=w.MeshBuilder.CreatePlane("desktop",{width:x,height:O},a)).position=new w.Vector3(0,1,0),o.rotation=new w.Vector3(0,0,0),r=new w.StandardMaterial("mat",a),e.next=8,w.VideoTexture.CreateFromStreamAsync(a,t);case 8:return(i=e.sent).uScale=1,i.vScale=-1,r.diffuseTexture=i,o.material=r,a.onPointerUp=function(){i.video.play()},c=new S.a,s=w.Mesh.CreatePlane("impact",1,a),u=s.material=new w.StandardMaterial("impactMat",a),s.scaling=new w.Vector3(.02,.02,.04),u.diffuseTexture=new w.Texture("textures/impact.png",a),u.diffuseTexture.hasAlpha=!0,s.position=new w.Vector3(0,0,-.01),a.onPointerDown=function(e,n){if(n.hit){var t=n.pickedPoint,a=t.x,o=t.y;-1.7<a&&a<1.7&&(s.position.x=a),0<o&&o<2&&(s.position.y=o);var r=o/O;c.execute({x:(a+1.7)/x,y:1-r})}},e.abrupt("return",c);case 23:case"end":return e.stop()}},e)}))).apply(this,arguments)}var C=t(31),E=t.n(C),M=t(32),L=t.n(M);function T(e,n,t){var a=E.a.connect(e);return new Promise(function(e){var o=new L.a({nodeId:"offer",trickle:t});a.emit("join",{roomId:n}),a.on("join",function(){o.makeOffer()}),a.on("sdp",function(e){console.log({data:e}),o.setSdp(e.sdp)});var r=o.onSignal.subscribe(function(e){console.log({sdp:e,roomId:n}),a.emit("sdp",{sdp:e,roomId:n})});o.onConnect.once(function(){console.log("connect"),e(o),r.unSubscribe()}),o.onData.subscribe(function(e){console.log({message:e})})})}function V(e,n){e.canvas;var t=e.scene,a=(e.engine,new S.a),o=t.createDefaultVRExperience({createDeviceOrientationCamera:!1});return o.enableTeleportation({floorMeshes:[n.ground]}),o.onControllerMeshLoaded.add(function(e){e.onSecondaryButtonStateChangedObservable.add(function(n,t){"right"===e.hand&&n.pressed&&a.execute()})}),a}var D=function(e){function n(e){var t;return Object(p.a)(this,n),(t=Object(h.a)(this,Object(v.a)(n).call(this,e))).peer=void 0,t.ref=void 0,t.connect=Object(l.a)(d.a.mark(function e(){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T("https://aqueous-earth-75182.herokuapp.com/",t.state.address,!1);case 2:n=e.sent,t.peer=n,t.setState({address:""}),n.onAddTrack.subscribe(function(e){console.log(e),t.setState({stream:e}),t.ref.srcObject=e});case 6:case"end":return e.stop()}},e)})),t.onSceneMount=function(){var e=Object(l.a)(d.a.mark(function e(n){var a,o,r,i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=n.canvas,o=n.scene,r=n.engine,new w.HemisphericLight("sunLight",new w.Vector3(0,1,0),o),new w.FreeCamera("camera",new w.Vector3(0,1,-5),o).attachControl(a,!0),o.activeCamera.beta+=.8,(i=o.createDefaultEnvironment({enableGroundShadow:!0,groundYBias:1})).setMainColor(w.Color3.FromHexString("#74b9ff")),V(n,i).subscribe(function(){t.peer&&t.peer.send(JSON.stringify({type:"click"}))}),o.onBeforeRenderObservable.add(function(){t.state.stream&&(k(n,t.state.stream).then(function(e){return e.subscribe(function(e){t.peer&&t.peer.send(JSON.stringify({type:"move",payload:e}))})}),t.setState({stream:void 0}))}),r.runRenderLoop(function(){o&&o.render()});case 10:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}(),t.state={stream:void 0,address:""},t}return Object(m.a)(n,e),Object(f.a)(n,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("div",{style:{display:"flex"}},o.a.createElement("input",{onChange:function(n){return e.setState({address:n.target.value})}}),o.a.createElement("button",{onClick:this.connect},"connect")),o.a.createElement(b,{onSceneMount:this.onSceneMount,height:400,width:600}),o.a.createElement("video",{ref:function(n){return e.ref=n},autoPlay:!0,width:340,height:200}))}}]),n}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(c.a,null,o.a.createElement("div",null,o.a.createElement(s.a,{exact:!0,path:"/",component:D}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[55,1,2]]]);
//# sourceMappingURL=main.0291a175.chunk.js.map